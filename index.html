<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>EcoStyle | Tienda</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles/layout.css">
    <link rel="stylesheet" href="styles/index.css">
    <link rel="stylesheet" href="styles/catalogo.css">
</head>

<body>
    <div id="navbar-container"></div>
    <main>
        <!-- carrusel-->
        <div id="carouselExampleFade" class="carousel slide carousel-fade">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="images/1.jpg" class="d-block w-100" alt="Oferta 1">
                    <div class="carousel-caption d-none d-md-block">
                        <h2 class="fw-bold">Tus plantitas favoritas al mejor precio.</h2>
                        <p>Encuentra tus favoritas en tu lugar favorito.</p>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="images/arbol-bosque-naturaleza-viejo-wallpaper-preview.jpg" class="d-block w-100" alt="Oferta 2">
                    <div class="carousel-caption d-none d-md-block">
                        <h2 class="fw-bold">Ofertas Imperdibles</h2>
                        <p>Stock limitado. ¡Aprovecha!</p>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="images/4.jpg" class="d-block w-100" alt="Oferta 3">
                    <div class="carousel-caption d-none d-md-block">
                        <h2 class="fw-bold">¡¡Oferta Especial!!</h2>
                        <p>Encuentra tus favoritas en tu lugar favorito.</p>
                    </div>
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleFade"
                data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleFade"
                data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>

        <div class="container py-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="mb-0">Productos destacados</h3>
                <a class="btn btn-outline-primary btn-sm" href="carrito.html">Ver carrito</a>
            </div>

<!-- Fila de 3 tarjetas animadas -->
            <div class="d-flex justify-content-center gap-4 mb-4 flex-wrap tarjetas-animadas">
                <div class="card card-menu" data-nombre="Monstera" data-img="images/monstera.jpg" data-id="1001" data-precio="7990" data-descripcion="La danza vegetal de la selva condensada en una hoja, regalando con su belleza, estragos de la constelacione">
                    <div class="first-content">
                        <span>
                            <img src="images/monstera.jpg" alt="monstera1" width="190" height="254">
                        </span>
                    </div>
                    <div class="second-content">
                        <span>
                            <img src="images/monstera2.jpg" alt="monstera2" width="190" height="254">
                        </span>
                    </div>
                </div>
                <div class="card card-menu" data-nombre="Alocasia" data-img="images/alocasia.jpg" data-id="1002" data-precio="9990" data-descripcion="El manto de eva con su grandeza, nos regala la eterna sombra de las tardes, un presente paradisiatico atenuante de sus hojas.">
                    <div class="first-content">
                        <span><img src="images/alocasia.jpg" alt="alocasia" width="190" height="254"></span>
                    </div>
                    <div class="second-content">
                        <span><img src="images/alocasia-2.jpg" alt="alocasia2" width="190" height="254"></span>
                    </div>
                </div>
                <div class="card card-menu" data-nombre="Ficus" data-img="images/ficus.jpg" data-id="1003" data-precio="12990" data-descripcion="la joya oculta de un universo aún no descubierto, un susurro carmesí de estrellas que danzan entre sí, reflejan la luz como si cada veta guardara el mapa de una dimensión auún no descubierta.">
                    <div class="first-content">
                        <span><img src="images/ficus.jpg" alt="ficus" width="190" height="254"></span>
                    </div>
                    <div class="second-content">
                        <span><img src="images/ficus2.jpg" alt="ficus2" width="190" height="254"></span>
                    </div>
                </div>
            </div>
            <!-- Modal para agregar al carrito -->
            <div class="modal fade" id="menuModal" tabindex="-1" aria-labelledby="menuModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="menuModalLabel">Agregar al carrito</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                        </div>
                        <div class="modal-body text-center">
                            <img id="modalImg" src="" alt="" style="max-width:180px;max-height:180px;border-radius:10px;">
                            <h5 id="modalNombre" class="mt-3"></h5>
                            <p id="modalDescripcion" class="mb-2"></p>
                            <p id="modalPrecio" class="mb-2"></p>
                            <div class="input-group mb-3 w-50 mx-auto">
                                <span class="input-group-text">Cantidad</span>
                                <input type="number" id="modalCantidad" class="form-control" min="1" value="1">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="button" class="btn btn-primary" id="modalAgregar">Agregar al carrito</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row g-4" id="destacados"></div>
        </div>
    </main>

    <div id="footer-container"></div>


    <!-- Script!-->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/layout.js"></script>
    <script>
        // Navbar y footer
            $(document).ready(function() {
            window.Layout.LoadPartials();
        });
        // Modal de menú para agregar al carrito desde tarjetas animadas
        let productoSeleccionado = null;
        $(document).on('click', '.card-menu', function () {
            const nombre = $(this).data('nombre');
            const img = $(this).data('img');
            const id = $(this).data('id');
            const precio = $(this).data('precio');
            const descripcion = $(this).data('descripcion') || '';
            productoSeleccionado = { id, nombre, precio, img, descripcion };
            $('#modalImg').attr('src', img);
            $('#modalNombre').text(nombre);
            $('#modalDescripcion').text(descripcion);
            $('#modalPrecio').text('Precio: ' + new Intl.NumberFormat('es-CL', { style: 'currency', currency: 'CLP', maximumFractionDigits: 0 }).format(precio));
            $('#modalCantidad').val(1);
            const modal = new bootstrap.Modal(document.getElementById('menuModal'));
            modal.show();
        });
        $('#modalAgregar').on('click', function () {
            if (!productoSeleccionado) return;
            const cantidad = Number($('#modalCantidad').val()) || 1;
            let cart = JSON.parse(localStorage.getItem('APP_CART') || '[]');
            const found = cart.find(i => i.id == productoSeleccionado.id);
            if (found) {
                found.qty = (found.qty || 1) + cantidad;
            } else {
                cart.push({ id: Number(productoSeleccionado.id), name: productoSeleccionado.nombre, price: Number(productoSeleccionado.precio), qty: cantidad });
            }
            localStorage.setItem('APP_CART', JSON.stringify(cart));
            const modal = bootstrap.Modal.getInstance(document.getElementById('menuModal'));
            modal.hide();
        });
    </script>
    <script>
        const PROD_KEY = "APP_PRODS";
        const CART_KEY = "APP_CART";
        const fmt = new Intl.NumberFormat('es-CL', { style: 'currency', currency: 'CLP', maximumFractionDigits: 0 });

        function getProds() { try { return JSON.parse(localStorage.getItem(PROD_KEY)) || []; } catch { return []; } }
        function getCart() { try { return JSON.parse(localStorage.getItem(CART_KEY)) || []; } catch { return []; } }
        function saveCart(c) { localStorage.setItem(CART_KEY, JSON.stringify(c)); window.dispatchEvent(new CustomEvent('cart:updated')); }

        function renderDestacados() {
            const prods = getProds();
            const $wrap = $('#destacados').empty();
            if (!prods.length) {
                $wrap.append(`<div class="col-12"><div class="alert alert-info">Aún no hay productos. Cárgalos en Admin.</div></div>`);
                return;
            }
            // mostrar hasta 3 primeros (o elige aleatorios si quieres)
            prods.slice(0, 3).forEach(p => {
                const imgSrc = p.img || `https://picsum.photos/seed/prod${p.id}/600/400`;
                $wrap.append(`
          <div class="col-12 col-sm-6 col-lg-4">
            <div class="card h-100">
              <img src="${imgSrc}" class="card-img-top" alt="${p.nombre}">
              <div class="card-body d-flex flex-column">
                <h5 class="card-title">${p.nombre}</h5>
                <p class="text-muted small mb-2">Stock: ${p.stock}</p>
                <div class="mt-auto d-flex justify-content-between align-items-center">
                  <span class="fw-bold">${fmt.format(Number(p.precio) || 0)}</span>
                  <button class="btn btn-primary btn-sm addToCart" data-id="${p.id}" data-name="${p.nombre}" data-price="${p.precio}">Agregar</button>
                </div>
              </div>
            </div>
          </div>
        `);
            });
        }

        $(function () {
            // Obliga login si entran directo por URL
            const user = AuthStore.getCurrentUser();
            if (!user) { location.href = 'login.html'; return; }

            Layout.loadPartials();
            renderDestacados();

            $(document).on('click', '.addToCart', function () {
                const id = Number($(this).data('id'));
                const name = $(this).data('name');
                const price = Number($(this).data('price')) || 0;
                const cart = getCart();
                const found = cart.find(i => i.id === id);
                if (found) { found.qty = (found.qty || 1) + 1; }
                else { cart.push({ id, name, price, qty: 1 }); }
                saveCart(cart);
            });
        });
        
        
    </script>


    <div id="footer-container"></div>
</body>

</html>